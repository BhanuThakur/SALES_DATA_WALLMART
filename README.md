create database if not exists SALESDATAWALLMART;

    create table if not exists WALMART_SALES (
    INVOICE_ID varchar (30) not null primary key,
    BRANCH varchar(10) not null,
    CITY varchar (10) not null,
    CUSTOMER_TYPE varchar (20) not null,
    GENDER VARCHAR (10) not null,
    PRODUCT_LINE Varchar(100) not null,
    UNIT_PRICE DECIMAL(10,2)  not null,
    QUANTITY INT NOT NULL,
    VAT DECIMAL (6,4) NOT NULL,
    TOTAL DECIMAL (12,4) not Null,
    DATE DATETIME NOT NULL,
    TIME TIME not Null,
    PAYMENT_METHOD varchar (20) NOT NULL,
    COG DECIMAL (10,2) NOT NULL,
    GROSS_MARGIN_PCT decimal (11,9),
    GROSS_INCOME DECIMAL (12,4) NOT NULL,
    RATING Decimal (2,1) 
    );


    SELECT * FROM salesdatawallmart.walmart_sales;

-- FIRST I WILL CREATE A NEW COLUMN AND THEN ADD IT INTO TABLE.
-- FIRST CREATING A COLUMN WITH NAME  (TIME_OF_DAY)

    select time from walmart_sales;

    select time,
     (CASE
	WHEN time BETWEEN "00:00:00" AND "12:00:00" THEN "MORNING"
    WHEN time BETWEEN "12:01:00" AND "16:00:00" THEN "AFTERNOON"
    ELSE "EVENING"
    END
     ) AS TIME_OF_DAY
    from walmart_sales;

-- NOW ADDING THIS COLUMN (TIME_OF_DAY) IN TABLE (SALESDATAWALLMART)

    ALTER TABLE WALMART_SALES ADD COLUMN TIME_OF_DAY VARCHAR(20);


-- THIS NEW COLUMN (TIME_OF_DAY) HAS BEEN ADDED.
  
    SELECT * FROM WALMART_SALES; 

-- DATE IS NOT INSERTED YET INSIDE TIME_OF_DAY.
  
    UPDATE WALMART_SALES SET  TIME_OF_DAY = (
    CASE
	WHEN time BETWEEN "00:00:00" AND "12:00:00" THEN "MORNING"
    WHEN time BETWEEN "12:01:00" AND "16:00:00" THEN "AFTERNOON"
    ELSE "EVENING"
    END
    );

-- NOW CHECK IF DATA IS INSERTED.
  
    SELECT * FROM WALMART_SALES; 


-- I WILL ADD DAY_NAME

    SELECT DATE FROM WALMART_SALES; 

    ALTER TABLE WALMART_SALES ADD COLUMN DAY_NAME VARCHAR(20);

    SELECT * FROM WALMART_SALES; 
    UPDATE WALMART_SALES SET  DAY_NAME = (
	DAYNAME(DATE)
    );

    SELECT * FROM walmart_sales;

-- I WILL ADD MONTH_NAME

    ALTER TABLE WALMART_SALES ADD COLUMN MONTH_NAME VARCHAR(20);

    UPDATE WALMART_SALES SET MONTH_NAME = (
    MONTHNAME(DATE)
    );
    SELECT * FROM WALMART_SALES; 


-- HOW MANY UNIQUE CITIES DOES THE DATA HAVE ?

    SELECT DISTINCT CITY FROM WALMART_SALES; 

-- IN WHICH CITY EACH BRANCH !!
 
    SELECT * FROM WALMART_SALES; 
    SELECT DISTINCT CITY FROM WALMART_SALES WHERE BRANCH IN ("A","B","c"); 



-- PRODUCT --

-- HOW MANY UNIQUE PRODUCT LINE DOES THE DATA HAVE !!

    SELECT * FROM WALMART_SALES; 
    SELECT COUNT(DISTINCT PRODUCT_LINE) FROM WALMART_SALES;

-- WHAT IS MOST COMMON PAYMENT METHOD.

    SELECT * FROM WALMART_SALES; 
    SELECT PAYMENT_METHOD , COUNT(PAYMENT_METHOD) FROM walmart_sales GROUP BY PAYMENT_METHOD ORDER BY COUNT(PAYMENT_METHOD) DESC limit 1; 


-- WHAT IS THE MOST SELLING PRODUCT_LINE !!

    SELECT * FROM WALMART_SALES; 

    SELECT PRODUCT_LINE, SUM(QUANTITY) FROM walmart_sales GROUP BY(PRODUCT_LINE) ORDER BY SUM(QUANTITY) DESC;  

-- TOTAL REVENUE BY MONTH !!

    SELECT * FROM WALMART_SALES;
    SELECT MONTH_NAME, ROUND(SUM(TOTAL),1) AS TOTAL_REVENUE FROM walmart_sales GROUP BY (MONTH_NAME) ORDER BY SUM(TOTAL) DESC;   

-- WHAT MONTH HAD THE LARGEST COGS !!

    SELECT * FROM WALMART_SALES;
    SELECT MONTH_NAME, ROUND(SUM(COG),2) AS LARGEST_COGS FROM walmart_sales GROUP BY (MONTH_NAME) ORDER BY SUM(COG) DESC LIMIT 1;   


-- WHAT PRODUCT LINE HAD THE LARGEST REVENUE !!

    SELECT * FROM WALMART_SALES;
    SELECT PRODUCT_LINE, ROUND(SUM(TOTAL),2) REVENVUE FROM walmart_sales GROUP BY (PRODUCT_LINE) ORDER BY SUM(TOTAL) DESC LIMIT 1;


-- WHAT IS THE CITY WITH LARGEST REVENUE !!

    SELECT * FROM WALMART_SALES;
    SELECT CITY, ROUND(SUM(TOTAL),2) REVENUE FROM walmart_sales GROUP BY CITY ORDER BY SUM(TOTAL) DESC LIMIT 1; 

-- WHAT PRIDUCT LINE HAD THE LARGEST VAT !!

     SELECT * FROM WALMART_SALES;
     SELECT PRODUCT_LINE, ROUND(SUM(VAT),2) FROM walmart_sales GROUP BY (PRODUCT_LINE) ORDER BY SUM(VAT) DESC LIMIT 1;  



-- FETCH EACH PRODUCT LINE AND ADD A COLUMN TO THOSE PRODUCT LINE SHOWING "GOOD","BAD" . GOOD IF ITS GREATER THAN AVERAGE SALES. 

-- WHICH BRANCH SOLD MORE PRODUCTS THAN AVERAGE PRODUCT SOLD !!

    SELECT * FROM walmart_sales;
    SELECT BRANCH, SUM(QUANTITY) AS QTY FROM walmart_sales GROUP BY BRANCH HAVING SUM(QUANTITY) > (SELECT AVG(QUANTITY) FROM walmart_sales);

-- WHAT IS THE MOST COMMON PRODUCT_LINE BY GENDER !!

    SELECT * FROM walmart_sales;
    SELECT GENDER, PRODUCT_LINE , COUNT(GENDER) FROM walmart_sales GROUP BY (GENDER) , (PRODUCT_LINE) ORDER BY COUNT(GENDER) DESC;    

-- WHAT IS THE AVERAGE RATING FOR EACH PRODUCT LINE !!

    SELECT * FROM walmart_sales;
    SELECT PRODUCT_LINE , ROUND(AVG(RATING),2) FROM WALMART_SALES GROUP BY (PRODUCT_LINE) ORDER BY AVG(RATING) DESC;



-- SALES 

-- NUMBER OF SALES MADE IN EACH TIME OF THE DAY PER WEEKDAY.

    SELECT * FROM walmart_sales;
    SELECT HOUR(TIME), COUNT(INVOICE_ID) FROM walmart_sales GROUP BY HOUR(TIME) ORDER BY HOUR(TIME) ASC; 

    SELECT TIME_OF_DAY, COUNT(INVOICE_ID) FROM walmart_sales GROUP BY TIME_OF_DAY ORDER BY COUNT(INVOICE_ID) DESC; 

-- NOW I CAN USE ANY DAY TO KNOW THE SALE IN THAT PARTICULAR DAY.

    SELECT TIME_OF_DAY, COUNT(INVOICE_ID) FROM walmart_sales WHERE DAY_NAME = "SUNDAY" GROUP BY TIME_OF_DAY ORDER BY COUNT(INVOICE_ID) DESC; 
    SELECT TIME_OF_DAY, COUNT(INVOICE_ID) FROM walmart_sales WHERE DAY_NAME = "MONDAY" GROUP BY TIME_OF_DAY ORDER BY COUNT(INVOICE_ID) DESC; 


-- WHICH OF THE CUSTOMER TYPES BRINGS THE MOST REVENUE ?

    SELECT * FROM walmart_sales;
    SELECT CUSTOMER_TYPE , SUM(TOTAL) FROM walmart_sales GROUP BY CUSTOMER_TYPE ORDER BY SUM(TOTAL); 



-- WHICH CITY HAS THE LARGEST TAX PERCENTAGE / VAT(VALUE ADDED TAX) ?

    SELECT * FROM walmart_sales;
    SELECT CITY , ROUND(SUM(VAT),2) FROM walmart_sales GROUP BY CITY ORDER BY SUM(VAT) DESC; 


-- WHICH CUSTOMER TYPE PAYS THE MOST IN VAT ?

    SELECT CUSTOMER_TYPE , ROUND(SUM(VAT),2) FROM walmart_sales GROUP BY CUSTOMER_TYPE ORDER BY SUM(VAT) DESC; 



-- CUSTOMER 

-- WHAT CUSTOMER TYPE BUYS THE MOST.

    SELECT CUSTOMER_TYPE , COUNT(*) FROM walmart_sales GROUP BY CUSTOMER_TYPE ORDER BY COUNT(*) DESC; 

-- WHAT IS THE GENDER OF MOST OF THE CUSTOMERS.

    SELECT * FROM walmart_sales;
    SELECT GENDER , COUNT(GENDER) FROM walmart_sales GROUP BY GENDER ORDER BY COUNT(GENDER) ;

-- WHAT IS THE GENDER DISTRIBUTION PER BRANCH.

    SELECT * FROM walmart_sales;
    SELECT GENDER, BRANCH , COUNT(GENDER) FROM walmart_sales GROUP BY  GENDER, BRANCH ORDER BY COUNT(GENDER);
    SELECT GENDER, BRANCH , COUNT(GENDER) FROM walmart_sales WHERE BRANCH = "A" GROUP BY  GENDER, BRANCH ORDER BY COUNT(GENDER);


-- WHICH TIME OF THE DAY CUSTOMER GIVE MORE RATING.

    SELECT * FROM walmart_sales;
    SELECT HOUR(TIME), COUNT(RATING) FROM walmart_sales GROUP BY HOUR(TIME) ORDER BY COUNT(RATING) DESC LIMIT 1;
    SELECT TIME_OF_DAY, COUNT(RATING) FROM walmart_sales GROUP BY TIME_OF_DAY ORDER BY COUNT(RATING) DESC LIMIT 1;
    SELECT TIME_OF_DAY, COUNT(RATING) FROM walmart_sales WHERE BRANCH = "B" GROUP BY TIME_OF_DAY ORDER BY COUNT(RATING);

-- WHICH DAY OF THE WEEK HAS THE BEST AVERAGE RATINGS.

    SELECT * FROM walmart_sales;
    SELECT DAY_NAME , AVG(RATING) FROM walmart_sales GROUP BY (DAY_NAME) ORDER BY AVG(RATING) DESC;  

-- WHICH DAY OF THE WEEK HAS THE BEST AVERAGE RATINGS PER BRANCH.
 
    SELECT DAY_NAME , BRANCH, AVG(RATING) FROM walmart_sales GROUP BY (DAY_NAME), BRANCH ORDER BY AVG(RATING) DESC;  
